<!doctype html>
<meta charset=utf-8>
<body id=b>
<canvas id=a width=640 height=360>
<script>
d = document;
g = a.getContext('webgl');

/*
=========================
 WebGL Shader Playground
=========================

JS1k entry by The Codegolf Team (xem, LiterallyLara, nderscore, Subzey)
Inspired by htp://www.shadertoy.com
Based on http://xem.github.com/MiniShadertoy
Full story on http://xem.github.io/articles/#webgl_quest
Cheers to aemkei, p01 and sqaxomonophonen who also contributed to the original app.

~~~

This demo provides a fully functional, mobile-friendly WebGL shader playground (canvas + textarea),
with a built-in demo (made by LiterallyLara), mouse support, shareable URLs, and compatibility with Shadertoy:
Demos created in this playground also work on Shadertoy,
and Shadertoy's demos that only feature a shader (i.e. no channels or other assets) will also work here.
(for example: https://www.shadertoy.com/view/Ms2SD1)
The canvas can also be set to fullscreen size by double-clicking it.

~~~

The shader inputs have the same name as the ones provided by Shadertoy:
- uniform vec3  iResolution; // viewport resolution = vec2(640.0, 360.0)
- uniform float iGlobalTime; // playback time (in seconds)
- uniform float iTimeDelta;  // render time since last frame (in seconds)
- uniform int   iFrame;      // playback frame
- uniform vec4  iMouse;      // mouse pixel coords. xy: current (if left button is down), zw: click coords.
- uniform vec4  iDate;       // current timestamp in seconds

Your shader must be placed in the following function:

void mainImage(out vec4 color,in vec2 coord){
  // code
}

~~~

The following commented code is very complex due to the extreme code-golfing required to make it fit in 1kb.
For more readability, you can first read our first (ungolfed) version here: https://github.com/xem/MiniShadertoy/blob/gh-pages/ungolfed.js

~~~

JS1K's shim gives the following vars for free:
- a: canvas element
- b: body
- d: document
- g: webgl context for the canvas.

*/




b.innerHTML+=`<textarea id=c>`+ 
(
  atob(
    top.location.hash.slice(
      y=z=1
    )
  )
  ||
  `// WebGL playground!\nvoid mainImage(out vec4 color,vec2 coord){\n  vec4 p=vec4((coord/iResolution-.5)*2.,0,1);\n  color=p+sin(atan(p.y,p.x)*9.)*sin(p*iGlobalTime/2.+9./dot(p,p)+iGlobalTime*5.);\n}`
);
  
for(i in g=a.getContext`webgl`){
  g[i[0]+i[6]]=g[i]
}

with(g){
  (
    oninput=e=>{
      top.location.hash=btoa(c.value),
      h=FN,
      vA(
        p=cP(
          i=e=>{
            sS(s=cS(h++),e)|ce(s)|!aS(p,s)
          }
        ),
        2,
        5120,
        bD(
          n=ET-3,
          Int8Array.of(
            i(`precision mediump float;uniform float iGlobalTime,iFrame,iDate,iTimeDelta;uniform vec2 iResolution;uniform vec4 iMouse;`+c.value+`void main(){mainImage(gl_FragColor,gl_FragCoord.xy);gl_FragColor.w=1.;}`),
            n,
            !eV(
              bf(
                n,
                cB(
                  m=[o=j=d=0]
                )
              )
            ),
            i`attribute vec4 p;void main(){gl_Position=p;}`
          ),
          n+82
        ),
        !lo(p),
        ug(p)
      ),
      f=new Date/1e3
    }
  )
  (
    a.onmousemove=e=>y||([m[0],m[1]]=[e.pageX*z/2,e.pageY])
  ),
  
  (
    l=e=>{
      uniform1f(gf(p,`iTimeDelta`),d=new Date/1e3-f),
      uniform1f(gf(p,`iDate`),f=new Date/1e3),
      uniform1f(gf(p,`iGlobalTime`),o+=d),
      uniform4f(gf(p,`iMouse`),m[0],m[1],m[2],m[3]),
      uniform2f(getUniformLocation(p,`iResolution`),640,360),
      dr(
        6,
        uniform1f(gf(p,`iFrame`),j++),
        3
      ),
      requestAnimationFrame(l)
    }
  )
  (
    a.onclick=e=>{
      [m[2],m[3]]=[e.pageX*z/2,e.pageY]
    }
  )
}
  
(
  a.ondblclick=e=>{
    a.style=
    c.style=
    (b.style=`height:100vh;margin:0;box-sizing:border-box;width:`)
    +100/(z^=3)
    +`%;float:left`
  }
)
(
  onmousedown=onmouseup=e=>{
    y^=1
  }
)

// Minified: 1517b
// RegPacked (settings: 2/1/0): 1024b


</script>