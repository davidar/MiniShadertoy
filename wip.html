<!doctype html>
<meta charset=utf-8>
<body id=b>
<canvas id=a width=640 height=360>
<script>
d = document;
g = a.getContext('webgl');

/*
=========================
 WebGL Shader Playground
=========================

by The Codegolf Team
Inspired by www.shadertoy.com
Based on http://xem.github.com/MiniShadertoy
Full story on http://xem.github.io/articles/#webgl_quest

~~~

This demo provides a fully functional WebGL shader playground,
with a built-in demo, mouse support, shareable URLs, and a 2-way compatibility with Shadertoy.

Demos created in this playground also work on Shadertoy,
and Shadertoy's demos that only feature a shader (i.e. no channels or other assets) will also work here.
(for example: https://www.shadertoy.com/view/Ms2SD1)

The canvas can also be set to full size by double-clicking it.

~~~

The shader inputs are the same as the ones provided by Shadertoy:

uniform vec3  iResolution; // viewport resolution = vec2(640.0, 360.0)
uniform float iGlobalTime; // playback time (in seconds)
uniform float iTimeDelta;  // render time since last frame (in seconds)
uniform int   iFrame;      // playback frame
uniform vec4  iMouse;      // mouse pixel coords. xy: current (if left button down), zw: click
uniform vec4  iDate;       // current timestamp in seconds

Your code is executed from the following function:

void mainImage(out vec4 fragColor,in vec2 fragCoord){
  // code
}

*/


// GUI
a.style="width:49.5%;height:96vh";
b.innerHTML+=`<textarea id=c style=width:49.5%;height:96vh>`;
c.value=atob(location.hash.slice(1)||btoa(`void mainImage(out vec4 fragColor,vec2 fragCoord){
  vec4 p=vec4((fragCoord/iResolution-.5)*2.,0,1);
  fragColor=p+sin(atan(p.y,p.x)*9.)*sin(p*iGlobalTime/2.+9./dot(p,p)+iGlobalTime*5.);
}`));

// Hash
for(i in g=a.getContext`webgl`)g[i[0]+i[6]]=g[i];
iMouse=[0];

// Implied "g."
with(g){

  // Reset shader and update hash on load and on input
  (oninput=e=>{
    location.hash=btoa(c.value);
    h=FN;
    A=e=>sS(S=cS(h++),e)|ce(S)|!aS(p,S);
    vA(
      p=cP(),
      2,
      5120,
      bD(
        B=ET-3,
        Int8Array.of(
          A(`precision mediump float;uniform float iGlobalTime,iFrame,iDate,iTimeDelta;uniform vec2 iResolution;uniform vec4 iMouse;${c.value}void main(){mainImage(gl_FragColor,gl_FragCoord.xy);gl_FragColor.w=1.;}`),
          B,
          !eV(
            bf(B,cB())
          ),
          A`attribute vec4 p;void main(){gl_Position=p;}`
        ),
        B+82
      ),
      !lo(p),
      ug(p)
    )
    o=iFrame=d=0;
    f=new Date/1E3;
  })(),

  // Loop
  (L=e=>{
  d=new Date/1E3-f;
  f=new Date/1E3;
  uniform1f(gf(p,`iTimeDelta`),d);
  uniform1f(gf(p,`iGlobalTime`),o+=d);
  uniform1f(gf(p,`iDate`),~~f);
  uniform4f(gf(p,`iMouse`),iMouse[0],iMouse[1],iMouse[2],iMouse[3]);
  uniform2f(getUniformLocation(p,`iResolution`),640,360);
  dr(6,uniform1f(gf(p,`iFrame`),iFrame++),3);
  requestAnimationFrame(L)
  })();
}

// Mouse inputs
y=z=1;
onmousedown=onmouseup=e=>y^=1;
a.onmousemove=e=>y||([iMouse[0],iMouse[1]]=[.495*e.pageX*z,e.pageY]);
a.onclick=e=>[iMouse[2],iMouse[3]]=[.495*e.pageX*z,e.pageY];
a.ondblclick=e=>{z=3-z,a.style.width=c.style.width=49.5*z+`%`}

</script>